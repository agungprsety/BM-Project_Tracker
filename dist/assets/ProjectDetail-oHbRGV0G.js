const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/utils-DGZViaHi.js","assets/vendor-query-dOYxXkJ3.js","assets/vendor-react-CfkJOBur.js","assets/index-kT17AKTn.js","assets/vendor-pdf-D-ScUWta.js","assets/vendor-supabase-Dq-Jb853.js","assets/vendor-icons-Jh-DJkRq.js","assets/index-t-KMp1u-.css"])))=>i.map(i=>d[i]);
import{_ as U}from"./vendor-pdf-D-ScUWta.js";import{j as e}from"./vendor-query-dOYxXkJ3.js";import{u as _}from"./index-kT17AKTn.js";import{b as F,e as M,h as W,i as E,c as L,j as V,k as v,a as Q,l as q,f as i,g as z}from"./utils-DGZViaHi.js";import{a as O}from"./exportPdf-C86UXNxD.js";import{C as w,B as m}from"./Button-Dqt4D0nT.js";import{P as G,a as H,B as J,W as K,S as X}from"./ProjectMap-P9Uv6naT.js";import{j as Y,f as Z}from"./vendor-react-CfkJOBur.js";import{l as ee,j as se,m as te,T as ae}from"./vendor-icons-Jh-DJkRq.js";import"./vendor-supabase-Dq-Jb853.js";import"./Input-8WHCH_aK.js";import"./vendor-charts-D7W35Enl.js";import"./vendor-maps-CQh9FGhc.js";function ge(){var b,N;const{id:P}=Y(),x=Z(),{darkMode:t}=_(),{data:s,isLoading:D}=F(P),o=M(),y=W();if(D)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});if(!s)return e.jsx("div",{className:"max-w-6xl mx-auto",children:e.jsxs(w,{darkMode:t,className:"text-center py-12",children:[e.jsx("p",{className:"text-lg mb-4",children:"Project not found"}),e.jsx(m,{onClick:()=>x("/dashboard"),children:"Back to Dashboard"})]})});const l=s.boq||[],d=s.weeklyReports||[],p=E(l),h=L(l,d),k=V(d),c=l.reduce((a,r)=>{const n=Math.min(k[r.id]||0,r.quantity);return a+n*r.unitPrice},0),S=(s.length||0)*(s.averageWidth||0),$=a=>{o.mutate({id:s.id,updates:{boq:a}})},C=a=>{o.mutate({id:s.id,updates:{weeklyReports:a}})},B=async a=>{try{const{projectService:r}=await U(async()=>{const{projectService:g}=await import("./utils-DGZViaHi.js").then(f=>f.m);return{projectService:g}},__vite__mapDeps([0,1,2,3,4,5,6,7])),n=[],j=Array.from(a).map(async g=>{const f=await r.uploadPhoto(g,s.id);return{id:z(),url:f,createdAt:new Date().toISOString()}}),R=await Promise.all(j);n.push(...R);const T=[...s.photos||[],...n];o.mutate({id:s.id,updates:{photos:T}})}catch(r){console.error("Failed to upload photos:",r),alert("Failed to upload one or more photos. Are your storage policies and bucket set up?")}},A=a=>{var n;const r=((n=s.photos)==null?void 0:n.filter(j=>j.id!==a))||[];o.mutate({id:s.id,updates:{photos:r}})},I=async()=>{window.confirm("Are you sure you want to delete this project? This action cannot be undone.")&&y.mutate(s.id,{onSuccess:()=>x("/dashboard")})},u=t?"from-gray-800 to-gray-900 border-gray-700":"from-white to-gray-50 border-gray-100";return e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[e.jsxs(w,{darkMode:t,children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:s.name}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${t?"bg-blue-900 text-blue-300":"bg-blue-100 text-blue-700"}`,children:((b=s.workType)==null?void 0:b.replace("-"," "))||""}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${t?"bg-green-900 text-green-300":"bg-green-100 text-green-700"}`,children:s.roadHierarchy||""}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${t?"bg-purple-900 text-purple-300":"bg-purple-100 text-purple-700"}`,children:s.maintenanceType||""}),s.location&&e.jsxs("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${t?"bg-amber-900 text-amber-300":"bg-amber-100 text-amber-700"}`,children:[e.jsx(ee,{size:10,className:"inline mr-1"}),"Location Set"]})]}),e.jsxs("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:["Project ID: ",s.id]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(m,{variant:"secondary",onClick:()=>O(s),children:[e.jsx(se,{size:18,className:"mr-2"})," Export PDF"]}),e.jsxs(m,{variant:"secondary",onClick:()=>x(`/projects/${s.id}/edit`),children:[e.jsx(te,{size:18,className:"mr-2"})," Edit"]}),e.jsxs(m,{variant:"danger",onClick:I,isLoading:y.isPending,children:[e.jsx(ae,{size:18,className:"mr-2"})," Delete"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[e.jsxs("div",{className:`bg-gradient-to-br p-6 rounded-xl border ${u}`,children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Project Info"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:t?"text-gray-400":"text-gray-600",children:"Contractor:"}),e.jsx("span",{className:"font-medium",children:s.contractor})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:t?"text-gray-400":"text-gray-600",children:"Supervisor:"}),e.jsx("span",{className:"font-medium",children:s.supervisor})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:t?"text-gray-400":"text-gray-600",children:"Dates:"}),e.jsxs("span",{className:"font-medium",children:[v(s.startDate)," - ",v(s.endDate)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:t?"text-gray-400":"text-gray-600",children:"Length:"}),e.jsx("span",{className:"font-medium",children:Q(s.length)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:t?"text-gray-400":"text-gray-600",children:"Avg. Width:"}),e.jsx("span",{className:"font-medium",children:s.averageWidth?`${s.averageWidth} m`:"-"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:t?"text-gray-400":"text-gray-600",children:"Area:"}),e.jsx("span",{className:"font-medium",children:q(S)})]}),s.district&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:t?"text-gray-400":"text-gray-600",children:"District:"}),e.jsx("span",{className:"font-medium",children:s.district})]}),s.subDistrict&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:t?"text-gray-400":"text-gray-600",children:"Sub-district:"}),e.jsx("span",{className:"font-medium",children:s.subDistrict})]})]})]}),e.jsxs("div",{className:`bg-gradient-to-br p-6 rounded-xl border ${u}`,children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Financial Summary"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:t?"text-gray-400":"text-gray-600",children:"Total Value:"}),e.jsx("span",{className:"font-bold text-blue-600",children:i(p)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:t?"text-gray-400":"text-gray-600",children:"Completed Value:"}),e.jsx("span",{className:"font-bold text-green-600",children:i(c)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:t?"text-gray-400":"text-gray-600",children:"Remaining Value:"}),e.jsx("span",{className:"font-bold text-amber-600",children:i(p-c)})]})]})]}),e.jsxs("div",{className:`bg-gradient-to-br p-6 rounded-xl border ${u}`,children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Progress Summary"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:t?"text-gray-400":"text-gray-600",children:"Current Progress:"}),e.jsxs("span",{className:"font-bold text-purple-600",children:[h.toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:t?"text-gray-400":"text-gray-600",children:"BoQ Items:"}),e.jsxs("span",{className:"font-medium",children:[l.length," items"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:t?"text-gray-400":"text-gray-600",children:"Weekly Reports:"}),e.jsxs("span",{className:"font-medium",children:[d.length," weeks"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:t?"text-gray-400":"text-gray-600",children:"Photos:"}),e.jsxs("span",{className:"font-medium",children:[((N=s.photos)==null?void 0:N.length)||0," photos"]})]})]})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:`flex justify-between text-sm mb-2 ${t?"text-gray-400":"text-gray-600"}`,children:[e.jsx("span",{children:"Project Progress"}),e.jsxs("span",{children:[h.toFixed(2),"%"]})]}),e.jsx("div",{className:`w-full ${t?"bg-gray-700":"bg-gray-200"} rounded-full h-4`,children:e.jsx("div",{className:"bg-gradient-to-r from-blue-500 via-blue-600 to-blue-700 h-4 rounded-full transition-all duration-500",style:{width:`${h}%`}})}),e.jsxs("div",{className:"flex justify-between text-xs mt-1 text-gray-500",children:[e.jsxs("span",{children:[i(c)," completed"]}),e.jsxs("span",{children:[i(p-c)," remaining"]})]})]})]}),e.jsx(G,{project:s,darkMode:t}),e.jsx(H,{photos:s.photos||[],onUpload:B,onDelete:A,darkMode:t}),e.jsx(J,{projectId:s.id,boq:l,onUpdate:$,darkMode:t}),e.jsx(K,{projectId:s.id,reports:d,boq:l,onUpdate:C,contractStartDate:s.startDate,contractEndDate:s.endDate,darkMode:t}),e.jsx(X,{project:s,darkMode:t})]})}export{ge as default};
