import{j as e}from"./vendor-query-dOYxXkJ3.js";import{f as V,a as o}from"./vendor-react-CfkJOBur.js";import{u as X,b as Y}from"./index-DaHXQ4-S.js";import{u as G,c as O,f as U,a as J}from"./utils-BfptotOI.js";import{D as A}from"./districts-Z7EIMGL1.js";import{C as m,B as Q}from"./Button-Dqt4D0nT.js";import{E as Z,f as ee,g as se,h as te,C as re}from"./vendor-icons-Jh-DJkRq.js";import{R as ae,B as le,X as ie,Y as oe,T as ce,a as ne,C as de}from"./vendor-charts-D7W35Enl.js";import"./vendor-pdf-D-ScUWta.js";import"./vendor-supabase-Dq-Jb853.js";const k=10,B=[{label:"0–25%",key:"low",color:"#dc2626",min:0,max:25},{label:"25–50%",key:"mid",color:"#d97706",min:25,max:50},{label:"50–75%",key:"high",color:"#2563eb",min:50,max:75},{label:"75–100%",key:"done",color:"#16a34a",min:75,max:101}];function ve(){const F=V(),{darkMode:a}=X(),{data:f=[],isLoading:L}=G(),{t:r}=Y(),[g,w]=o.useState(""),[v,R]=o.useState("progress"),[N,S]=o.useState("desc"),[h,c]=o.useState(1),[d,y]=o.useState(null),[n,D]=o.useState(""),[b,C]=o.useState(""),x=o.useMemo(()=>f.map(s=>{var t;return{...s,_progress:O(s.boq||[],s.weeklyReports||[]),_value:((t=s.boq)==null?void 0:t.reduce((l,i)=>l+i.quantity*i.unitPrice,0))||0}}),[f]),E=x.reduce((s,t)=>s+t._value,0),T=x.length>0?x.reduce((s,t)=>s+t._progress,0)/x.length:0,W=x.reduce((s,t)=>s+(t.length||0),0),j=o.useMemo(()=>{let s=[...x];if(g){const t=g.toLowerCase();s=s.filter(l=>l.name.toLowerCase().includes(t)||l.contractor.toLowerCase().includes(t)||l.supervisor.toLowerCase().includes(t))}return n&&(s=s.filter(t=>t.district===n)),b&&(s=s.filter(t=>t.subDistrict===b)),s},[x,g,n,b]),$=o.useMemo(()=>B.map(s=>({...s,count:j.filter(t=>t._progress>=s.min&&t._progress<s.max).length})),[j]),H=o.useMemo(()=>{if(!n)return[];const s=A.find(t=>t.name===n);return s?s.subDistricts:[]},[n]),P=o.useMemo(()=>{let s=[...j];if(d){const t=B.find(l=>l.key===d);t&&(s=s.filter(l=>l._progress>=t.min&&l._progress<t.max))}return s.sort((t,l)=>{let i=0;switch(v){case"name":i=t.name.localeCompare(l.name);break;case"contractor":i=t.contractor.localeCompare(l.contractor);break;case"supervisor":i=t.supervisor.localeCompare(l.supervisor);break;case"progress":i=t._progress-l._progress;break;case"value":i=t._value-l._value;break;case"district":i=(t.district||"").localeCompare(l.district||"");break;case"subDistrict":i=(t.subDistrict||"").localeCompare(l.subDistrict||"");break;case"averageWidth":i=(t.averageWidth||0)-(l.averageWidth||0);break;case"length":i=(t.length||0)-(l.length||0);break;case"roadHierarchy":i=(t.roadHierarchy||"").localeCompare(l.roadHierarchy||"");break}return N==="asc"?i:-i}),s},[j,d,v,N]),p=Math.max(1,Math.ceil(P.length/k)),_=Math.min(h,p),M=P.slice((_-1)*k,_*k),K=d||n||b||g,q=()=>{y(null),D(""),C(""),w(""),c(1)},u=s=>{v===s?S(N==="asc"?"desc":"asc"):(R(s),S("asc")),c(1)},I=s=>s>=75?"bg-green-500":s>=50?"bg-blue-500":s>=25?"bg-amber-500":"bg-red-500",z=`px-3 py-2 border rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors ${a?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`;return L?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:`flex items-center gap-2 px-4 py-2.5 rounded-xl text-sm font-medium ${a?"bg-blue-900/40 text-blue-300 border border-blue-700/50":"bg-blue-50 text-blue-700 border border-blue-200"}`,children:[e.jsx(Z,{size:16}),e.jsx("span",{children:r("dashboard.publicSubtitle")})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs(m,{darkMode:a,children:[e.jsx("p",{className:`text-sm font-medium mb-2 ${a?"text-gray-400":"text-gray-600"}`,children:r("dashboard.activeProjects")}),e.jsx("p",{className:"text-3xl font-bold",children:f.length})]}),e.jsxs(m,{darkMode:a,children:[e.jsx("p",{className:`text-sm font-medium mb-2 ${a?"text-gray-400":"text-gray-600"}`,children:r("dashboard.totalValue")}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:U(E)})]}),e.jsxs(m,{darkMode:a,children:[e.jsx("p",{className:`text-sm font-medium mb-2 ${a?"text-gray-400":"text-gray-600"}`,children:r("dashboard.avgProgress")}),e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:[T.toFixed(1),"%"]})]}),e.jsxs(m,{darkMode:a,children:[e.jsx("p",{className:`text-sm font-medium mb-2 ${a?"text-gray-400":"text-gray-600"}`,children:"Road Infrastructure"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:J(W)})]})]}),f.length===0?e.jsx(m,{darkMode:a,className:"text-center py-12",children:e.jsx("p",{className:`text-lg mb-4 ${a?"text-gray-400":"text-gray-600"}`,children:r("dashboard.noProjects")})}):e.jsxs(e.Fragment,{children:[e.jsxs(m,{darkMode:a,children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("div",{children:e.jsx("h3",{className:"text-lg font-semibold",children:r("dashboard.progressDist")})}),d&&e.jsx("button",{onClick:()=>{y(null),c(1)},className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"Clear filter ×"})]}),e.jsx(ae,{width:"100%",height:250,children:e.jsxs(le,{data:$,margin:{left:30,right:20,top:20,bottom:25},children:[e.jsx(ie,{dataKey:"label",tick:{fontSize:12},label:{value:r("dashboard.xAxis"),position:"insideBottom",offset:-20,fontSize:12}}),e.jsx(oe,{allowDecimals:!1,tick:{fontSize:12},label:{value:r("dashboard.yAxis"),angle:-90,position:"insideLeft",offset:-15,fontSize:12}}),e.jsx(ce,{formatter:s=>[`${s} ${r("dashboard.tooltip")}`,"Count"],contentStyle:a?{backgroundColor:"#1f2937",border:"1px solid #374151",borderRadius:"8px"}:{borderRadius:"8px"}}),e.jsx(ne,{dataKey:"count",radius:[4,4,0,0],maxBarSize:60,cursor:"pointer",onClick:s=>{d===s.key?y(null):y(s.key),c(1)},children:$.map((s,t)=>e.jsx(de,{fill:s.color,opacity:d&&d!==s.key?.3:1},t))})]})})]}),e.jsxs(m,{darkMode:a,children:[e.jsxs("div",{className:"flex flex-col gap-3 mb-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3",children:[e.jsx("h3",{className:"text-lg font-semibold",children:r("dashboard.directory")}),e.jsxs("div",{className:"relative w-full sm:w-64",children:[e.jsx(ee,{size:16,className:`absolute left-3 top-1/2 -translate-y-1/2 ${a?"text-gray-500":"text-gray-400"}`}),e.jsx("input",{type:"text",placeholder:r("dashboard.search"),value:g,onChange:s=>{w(s.target.value),c(1)},className:`w-full pl-9 pr-3 py-2 border rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors ${a?"bg-gray-700 border-gray-600 text-white placeholder-gray-400":"bg-white border-gray-300 placeholder-gray-400"}`})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx(se,{size:16,className:a?"text-gray-400":"text-gray-500"}),e.jsxs("select",{value:n,onChange:s=>{D(s.target.value),C(""),c(1)},className:z,children:[e.jsx("option",{value:"",children:r("dashboard.allDistricts")}),A.map(s=>e.jsx("option",{value:s.name,children:s.name},s.code))]}),e.jsxs("select",{value:b,onChange:s=>{C(s.target.value),c(1)},className:z,disabled:!n,children:[e.jsx("option",{value:"",children:r("dashboard.allSubDistricts")}),H.map(s=>e.jsx("option",{value:s,children:s},s))]}),K&&e.jsx("button",{onClick:q,className:"text-sm text-blue-600 hover:text-blue-700 font-medium ml-auto",children:"Clear all ×"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:a?"bg-gray-700 text-gray-300":"bg-gray-50 text-gray-500",children:[e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium cursor-pointer",onClick:()=>u("name"),children:r("dashboard.thProject")}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium cursor-pointer",onClick:()=>u("district"),children:r("dashboard.thDistrict")}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium cursor-pointer",onClick:()=>u("averageWidth"),children:r("dashboard.thAvgWidth")}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium cursor-pointer",onClick:()=>u("length"),children:r("dashboard.thLength")}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium cursor-pointer",onClick:()=>u("roadHierarchy"),children:r("dashboard.thHierarchy")}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium cursor-pointer",onClick:()=>u("progress"),children:r("dashboard.thProgress")}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium",children:r("dashboard.thActions")})]})}),e.jsx("tbody",{children:M.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"px-3 py-8 text-center text-sm text-gray-500",children:r("dashboard.noProjects")})}):M.map(s=>e.jsxs("tr",{className:`border-t ${a?"border-gray-700 hover:bg-gray-700":"border-gray-200 hover:bg-gray-50"} transition-colors`,children:[e.jsx("td",{className:"px-3 py-3",children:e.jsx("div",{className:"font-medium",children:s.name})}),e.jsx("td",{className:"px-3 py-3 text-sm",children:s.district||"-"}),e.jsx("td",{className:"px-3 py-3 text-sm",children:s.averageWidth?`${s.averageWidth} m`:"-"}),e.jsx("td",{className:"px-3 py-3 text-sm",children:s.length?`${s.length} m`:"-"}),e.jsx("td",{className:"px-3 py-3 text-sm",children:s.roadHierarchy||"-"}),e.jsx("td",{className:"px-3 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-16 ${a?"bg-gray-600":"bg-gray-200"} rounded-full h-1.5`,children:e.jsx("div",{className:`${I(s._progress)} h-1.5 rounded-full`,style:{width:`${s._progress}%`}})}),e.jsxs("span",{className:"text-xs font-medium",children:[s._progress.toFixed(0),"%"]})]})}),e.jsx("td",{className:"px-3 py-3",children:e.jsx(Q,{size:"sm",variant:"secondary",onClick:()=>F(`/view/${s.id}`),children:r("dashboard.btnView")})})]},s.id))})]})}),p>1&&e.jsx("div",{className:"flex items-center justify-between mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>c(Math.max(1,h-1)),disabled:h===1,className:"p-1 rounded hover:bg-gray-100 dark:hover:bg-gray-700 disabled:opacity-50",children:e.jsx(te,{size:20})}),e.jsxs("span",{className:"text-sm",children:[h," of ",p]}),e.jsx("button",{onClick:()=>c(Math.min(p,h+1)),disabled:h===p,className:"p-1 rounded hover:bg-gray-100 dark:hover:bg-gray-700 disabled:opacity-50",children:e.jsx(re,{size:20})})]})})]})]})]})}export{ve as default};
