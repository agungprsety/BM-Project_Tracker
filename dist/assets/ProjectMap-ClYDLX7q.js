import{j as e}from"./vendor-query-dOYxXkJ3.js";import{a as D}from"./vendor-react-CfkJOBur.js";import{g as B,j as z,k as L}from"./utils-BfptotOI.js";import{C as S,B as k}from"./Button-Dqt4D0nT.js";import{I as C}from"./Input-8WHCH_aK.js";import{R as E,L as K,b as O,X as U,Y as G,T as X,c as Y,d as Q}from"./vendor-charts-D7W35Enl.js";import{M as Z,T as _,a as H,P as J,L as M}from"./vendor-maps-CQh9FGhc.js";function de({projectId:i,boq:n=[],onUpdate:l,darkMode:c=!1,readonly:x=!1}){const[g,r]=D.useState(!1),[s,p]=D.useState({itemNumber:"",description:"",unit:"",quantity:"",unitPrice:""}),u=()=>{if(!s.itemNumber||!s.description||!s.unit||!s.quantity||!s.unitPrice)return;const a={id:B(),itemNumber:s.itemNumber,description:s.description,unit:s.unit,quantity:Number(s.quantity),unitPrice:Number(s.unitPrice)};l([...n,a]),p({itemNumber:"",description:"",unit:"",quantity:"",unitPrice:""}),r(!1)},m=a=>{l(n.filter(b=>b.id!==a))},w=n.reduce((a,b)=>a+b.quantity*b.unitPrice,0);return e.jsxs(S,{darkMode:c,children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-xl font-bold",children:"Bill of Quantities (BoQ)"}),!x&&e.jsx(k,{size:"sm",onClick:()=>r(!0),children:"Add Item"})]}),n.length===0&&!g?e.jsx("p",{className:`text-center py-8 ${c?"text-gray-400":"text-gray-500"}`,children:"No BoQ items yet. Add items to define the contract scope."}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:c?"bg-gray-700 text-gray-300":"bg-gray-50 text-gray-500",children:[e.jsx("th",{className:"px-3 py-2 text-left",children:"Item"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Description"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"Unit"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"Qty"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"Unit Price"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"Total"}),!x&&e.jsx("th",{className:"px-3 py-2"})]})}),e.jsx("tbody",{children:n.map(a=>e.jsxs("tr",{className:`border-t ${c?"border-gray-700":"border-gray-200"}`,children:[e.jsx("td",{className:"px-3 py-2",children:a.itemNumber}),e.jsx("td",{className:"px-3 py-2",children:a.description}),e.jsx("td",{className:"px-3 py-2 text-right",children:a.unit}),e.jsx("td",{className:"px-3 py-2 text-right",children:a.quantity.toLocaleString("id-ID")}),e.jsxs("td",{className:"px-3 py-2 text-right",children:["Rp ",a.unitPrice.toLocaleString("id-ID")]}),e.jsxs("td",{className:"px-3 py-2 text-right font-medium",children:["Rp ",(a.quantity*a.unitPrice).toLocaleString("id-ID")]}),!x&&e.jsx("td",{className:"px-3 py-2",children:e.jsx("button",{onClick:()=>m(a.id),className:"text-red-500 hover:text-red-700",children:"×"})})]},a.id))})]})}),e.jsx("div",{className:`mt-4 pt-4 border-t ${c?"border-gray-700":"border-gray-200"} flex justify-end`,children:e.jsxs("div",{children:[e.jsx("span",{className:c?"text-gray-400":"text-gray-600",children:"Total Contract Value: "}),e.jsxs("span",{className:"font-bold text-blue-600",children:["Rp ",w.toLocaleString("id-ID")]})]})})]}),g&&!x&&e.jsxs("div",{className:`mt-4 p-4 rounded-lg border ${c?"border-gray-600 bg-gray-700":"border-gray-200 bg-gray-50"}`,children:[e.jsx("h4",{className:"font-semibold mb-3",children:"Add New BoQ Item"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:[e.jsx(C,{placeholder:"Item #",value:s.itemNumber,onChange:a=>p({...s,itemNumber:a.target.value})}),e.jsx(C,{placeholder:"Description",value:s.description,onChange:a=>p({...s,description:a.target.value}),className:"col-span-2"}),e.jsx(C,{placeholder:"Unit (e.g. m³, ton)",value:s.unit,onChange:a=>p({...s,unit:a.target.value})}),e.jsx(C,{type:"number",placeholder:"Contract Qty",value:s.quantity,onChange:a=>p({...s,quantity:a.target.value})}),e.jsx(C,{type:"number",placeholder:"Unit Price (Rp)",value:s.unitPrice,onChange:a=>p({...s,unitPrice:a.target.value})})]}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsx(k,{size:"sm",onClick:u,children:"Save"}),e.jsx(k,{size:"sm",variant:"secondary",onClick:()=>r(!1),children:"Cancel"})]})]})]})}function oe({projectId:i,reports:n=[],boq:l=[],onUpdate:c,contractStartDate:x,contractEndDate:g,darkMode:r=!1,readonly:s=!1}){const[p,u]=D.useState(!1),[m,w]=D.useState(null),[a,b]=D.useState([]),[d,I]=D.useState({weekNumber:"",startDate:"",endDate:"",workDescription:""}),[P,R]=D.useState({}),f=z(n),$=()=>{const t=[];(!d.weekNumber||!d.startDate||!d.endDate)&&t.push("Week number, start date, and end date are required."),d.startDate&&x&&d.startDate<x&&t.push(`Start date cannot be before contract start (${L(x)}).`),d.endDate&&g&&d.endDate>g&&t.push(`End date cannot be after contract end (${L(g)}).`),d.startDate&&d.endDate&&d.startDate>d.endDate&&t.push("Start date cannot be after end date.");const o=[];for(const j of l){const v=Number(P[j.id]||0);if(v<=0)continue;const N=f[j.id]||0,y=Math.max(0,j.quantity-N);v>y&&t.push(`${j.itemNumber}: quantity ${v} exceeds remaining ${y} ${j.unit}.`),o.push({boqItemId:j.id,quantity:Math.min(v,y)})}if(t.length>0){b(t);return}const h={id:B(),weekNumber:Number(d.weekNumber),startDate:d.startDate,endDate:d.endDate,workDescription:d.workDescription,itemProgress:o,photos:[],createdAt:new Date().toISOString()};c([...n,h]),I({weekNumber:"",startDate:"",endDate:"",workDescription:""}),R({}),b([]),u(!1)},W=t=>{c(n.filter(o=>o.id!==t))},q=l.reduce((t,o)=>t+o.quantity*o.unitPrice,0),T=l.reduce((t,o)=>{const h=Math.min(f[o.id]||0,o.quantity);return t+h*o.unitPrice},0),F=q>0?T/q*100:0;return e.jsxs(S,{darkMode:r,children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold",children:"Weekly Reports"}),e.jsxs("p",{className:`text-sm ${r?"text-gray-400":"text-gray-500"}`,children:[n.length," weeks • Overall Progress: ",F.toFixed(1),"%"]})]}),!s&&e.jsx(k,{size:"sm",onClick:()=>u(!0),disabled:l.length===0,children:"Add Report"})]}),l.length===0&&e.jsx("p",{className:`text-center py-4 text-sm ${r?"text-amber-400":"text-amber-600"}`,children:"Add BoQ items first before creating weekly reports."}),n.length===0&&!p?e.jsx("p",{className:`text-center py-8 ${r?"text-gray-400":"text-gray-500"}`,children:"No weekly reports yet. Add reports to track per-item progress."}):e.jsx("div",{className:"space-y-3",children:n.map(t=>{var v;const o=m===t.id,h=((v=t.itemProgress)==null?void 0:v.reduce((N,y)=>{const A=l.find(V=>V.id===y.boqItemId);return N+(A?y.quantity*A.unitPrice:0)},0))||0,j=q>0?h/q*100:0;return e.jsxs("div",{className:`rounded-lg border ${r?"border-gray-600 bg-gray-700":"border-gray-200 bg-gray-50"}`,children:[e.jsxs("div",{className:"p-4 cursor-pointer",onClick:()=>w(o?null:t.id),children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold",children:["Week ",t.weekNumber]}),e.jsxs("p",{className:`text-sm ${r?"text-gray-400":"text-gray-500"}`,children:[L(t.startDate)," - ",L(t.endDate)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`px-2 py-1 rounded text-sm font-medium ${j>0?"bg-blue-100 text-blue-700":r?"bg-gray-600 text-gray-400":"bg-gray-200 text-gray-500"}`,children:["+",j.toFixed(1),"%"]}),!s&&e.jsx("button",{onClick:N=>{N.stopPropagation(),W(t.id)},className:"text-red-500 hover:text-red-700",children:"×"})]})]}),t.workDescription&&e.jsx("p",{className:`mt-2 text-sm ${r?"text-gray-300":"text-gray-600"}`,children:t.workDescription})]}),o&&t.itemProgress&&t.itemProgress.length>0&&e.jsx("div",{className:`px-4 pb-4 border-t ${r?"border-gray-600":"border-gray-200"}`,children:e.jsxs("table",{className:"w-full text-xs mt-3",children:[e.jsx("thead",{children:e.jsxs("tr",{className:r?"text-gray-400":"text-gray-500",children:[e.jsx("th",{className:"text-left py-1",children:"BoQ Item"}),e.jsx("th",{className:"text-right py-1",children:"This Week"}),e.jsx("th",{className:"text-right py-1",children:"Contract Qty"}),e.jsx("th",{className:"text-right py-1",children:"Unit"})]})}),e.jsx("tbody",{children:t.itemProgress.map(N=>{const y=l.find(A=>A.id===N.boqItemId);return y?e.jsxs("tr",{className:`border-t ${r?"border-gray-600":"border-gray-200"}`,children:[e.jsxs("td",{className:"py-1",children:[y.itemNumber," - ",y.description]}),e.jsx("td",{className:"py-1 text-right font-medium",children:N.quantity}),e.jsx("td",{className:"py-1 text-right",children:y.quantity}),e.jsx("td",{className:"py-1 text-right",children:y.unit})]},N.boqItemId):null})})]})})]},t.id)})}),l.length>0&&n.length>0&&e.jsxs("div",{className:`mt-4 pt-4 border-t ${r?"border-gray-700":"border-gray-200"}`,children:[e.jsx("h4",{className:"font-semibold mb-3 text-sm",children:"Cumulative Progress per BoQ Item"}),e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:r?"text-gray-400":"text-gray-500",children:[e.jsx("th",{className:"text-left py-1",children:"Item"}),e.jsx("th",{className:"text-right py-1",children:"Completed"}),e.jsx("th",{className:"text-right py-1",children:"Contract Qty"}),e.jsx("th",{className:"text-right py-1",children:"Unit"}),e.jsx("th",{className:"text-right py-1",children:"Progress"})]})}),e.jsx("tbody",{children:l.map(t=>{const o=f[t.id]||0,h=t.quantity>0?Math.min(100,o/t.quantity*100):0;return e.jsxs("tr",{className:`border-t ${r?"border-gray-700":"border-gray-200"}`,children:[e.jsxs("td",{className:"py-1.5",children:[t.itemNumber," - ",t.description]}),e.jsx("td",{className:"py-1.5 text-right font-medium",children:o.toLocaleString("id-ID")}),e.jsx("td",{className:"py-1.5 text-right",children:t.quantity.toLocaleString("id-ID")}),e.jsx("td",{className:"py-1.5 text-right",children:t.unit}),e.jsx("td",{className:"py-1.5 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("div",{className:`w-16 ${r?"bg-gray-600":"bg-gray-200"} rounded-full h-1.5`,children:e.jsx("div",{className:`h-1.5 rounded-full ${h>=100?"bg-green-500":"bg-blue-500"}`,style:{width:`${h}%`}})}),e.jsxs("span",{className:`text-xs font-medium ${h>=100?"text-green-500":""}`,children:[h.toFixed(0),"%"]})]})})]},t.id)})})]})]}),p&&!s&&e.jsxs("div",{className:`mt-4 p-4 rounded-lg border ${r?"border-gray-600 bg-gray-700":"border-gray-200 bg-gray-50"}`,children:[e.jsx("h4",{className:"font-semibold mb-3",children:"Add Weekly Report"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:[e.jsx(C,{type:"number",placeholder:"Week #",value:d.weekNumber,onChange:t=>I({...d,weekNumber:t.target.value})}),e.jsx(C,{type:"date",placeholder:"Start Date",value:d.startDate,onChange:t=>I({...d,startDate:t.target.value}),min:x,max:g}),e.jsx(C,{type:"date",placeholder:"End Date",value:d.endDate,onChange:t=>I({...d,endDate:t.target.value}),min:d.startDate||x,max:g})]}),e.jsx(C,{placeholder:"Work description",value:d.workDescription,onChange:t=>I({...d,workDescription:t.target.value}),className:"mt-3"}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h5",{className:`text-sm font-medium mb-2 ${r?"text-gray-300":"text-gray-700"}`,children:"Progress This Week (quantities completed)"}),e.jsx("div",{className:`rounded-lg border ${r?"border-gray-600":"border-gray-300"}`,children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:r?"bg-gray-600 text-gray-300":"bg-gray-100 text-gray-500",children:[e.jsx("th",{className:"px-3 py-2 text-left",children:"Item"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"Remaining"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"This Week"})]})}),e.jsx("tbody",{children:l.map(t=>{const o=f[t.id]||0,h=Math.max(0,t.quantity-o);return e.jsxs("tr",{className:`border-t ${r?"border-gray-600":"border-gray-200"}`,children:[e.jsxs("td",{className:"px-3 py-2",children:[e.jsxs("div",{className:"font-medium",children:[t.itemNumber," - ",t.description]}),e.jsxs("div",{className:`text-xs ${r?"text-gray-400":"text-gray-500"}`,children:[t.quantity," ",t.unit," total"]})]}),e.jsx("td",{className:"px-3 py-2 text-right",children:e.jsxs("span",{className:h===0?"text-green-500 font-medium":"",children:[h.toLocaleString("id-ID")," ",t.unit]})}),e.jsx("td",{className:"px-3 py-2 text-right",children:e.jsx("input",{type:"number",value:P[t.id]||"",onChange:j=>{const v=Math.max(0,Math.min(h,Number(j.target.value)||0));R(N=>({...N,[t.id]:v>0?String(v):""}))},placeholder:"0",className:`w-24 px-2 py-1 border rounded text-right text-sm ${r?"bg-gray-700 border-gray-500":"border-gray-300"} ${h===0?"opacity-50 cursor-not-allowed":""}`,min:"0",max:h,step:"any",disabled:h===0})})]},t.id)})})]})})]}),a.length>0&&e.jsx("div",{className:"mt-3 p-3 rounded-lg bg-red-50 border border-red-200 text-red-700 text-sm",children:e.jsx("ul",{className:"list-disc list-inside space-y-1",children:a.map((t,o)=>e.jsx("li",{children:t},o))})}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsx(k,{size:"sm",onClick:$,children:"Save"}),e.jsx(k,{size:"sm",variant:"secondary",onClick:()=>{u(!1),b([])},children:"Cancel"})]})]})]})}function xe({photos:i=[],onUpload:n,onDelete:l,darkMode:c=!1,readonly:x=!1}){const g=D.useRef(null),r=s=>{s.target.files&&s.target.files.length>0&&(n==null||n(s.target.files),s.target.value="")};return e.jsxs(S,{darkMode:c,children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-xl font-bold",children:"Project Photos"}),!x&&e.jsxs("div",{children:[e.jsx("input",{ref:g,type:"file",accept:"image/*",multiple:!0,onChange:r,className:"hidden"}),e.jsx("button",{onClick:()=>{var s;return(s=g.current)==null?void 0:s.click()},className:"px-3 py-1 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm",children:"Upload Photos"})]})]}),i.length===0?e.jsx("p",{className:`text-center py-8 ${c?"text-gray-400":"text-gray-500"}`,children:"No photos yet. Upload photos to document project progress."}):e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:i.map(s=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:s.url,alt:s.caption||"Project photo",className:"w-full h-32 object-cover rounded-lg"}),!x&&e.jsx("div",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center",children:e.jsx("button",{onClick:()=>l==null?void 0:l(s.id),className:"px-3 py-1 bg-red-600 text-white rounded text-sm",children:"Delete"})}),s.caption&&e.jsx("p",{className:"text-xs mt-1 text-center truncate",children:s.caption})]},s.id))})]})}const ee=i=>{if(i<=0)return 0;if(i>=1)return 1;const n=x=>1/(1+Math.exp(-10*(x-.5))),l=n(0),c=n(1);return(n(i)-l)/(c-l)};function me({project:i,darkMode:n=!1}){const l=D.useMemo(()=>{var p;if(!i.startDate||!i.endDate)return[];const c=new Date(i.startDate),x=new Date(i.endDate),g=Math.ceil((x.getTime()-c.getTime())/(1e3*60*60*24)),r=[],s=((p=i.boq)==null?void 0:p.reduce((u,m)=>u+m.quantity*m.unitPrice,0))||0;for(let u=0;u<=Math.min(g,365);u+=7){const m=new Date(c);m.setDate(m.getDate()+u);const w=u/g,a=ee(w)*s;r.push({date:m.toLocaleDateString("id-ID",{month:"short",day:"numeric"}),planned:Math.round(a),actual:null})}if(i.weeklyReports&&i.weeklyReports.length>0&&i.boq){const u=[...i.weeklyReports].sort((m,w)=>m.weekNumber-w.weekNumber);for(let m=0;m<u.length;m++){const w=u[m],a=u.slice(0,m+1),b=z(a),d=i.boq.reduce((R,f)=>{const $=Math.min(b[f.id]||0,f.quantity);return R+$*f.unitPrice},0),I=new Date(w.startDate),P=r.findIndex((R,f)=>{const $=new Date(c);return $.setDate($.getDate()+f*7),$>=I});P>=0&&P<r.length&&(r[P]={...r[P],actual:Math.round(d)})}}return r},[i.startDate,i.endDate,i.weeklyReports,i.boq]);return e.jsxs(S,{darkMode:n,children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"S-Curve Analysis"}),l.length===0?e.jsx("p",{className:`text-center py-8 ${n?"text-gray-400":"text-gray-500"}`,children:"Add weekly reports to see S-Curve progress analysis."}):e.jsx(E,{width:"100%",height:350,children:e.jsxs(K,{data:l,children:[e.jsx(O,{strokeDasharray:"3 3"}),e.jsx(U,{dataKey:"date",tick:{fontSize:12}}),e.jsx(G,{tick:{fontSize:12},tickFormatter:c=>`${(c/1e6).toFixed(0)}M`}),e.jsx(X,{formatter:c=>[`Rp ${c.toLocaleString("id-ID")}`,""],contentStyle:n?{backgroundColor:"#1f2937",border:"none"}:{}}),e.jsx(Y,{}),e.jsx(Q,{type:"monotone",dataKey:"planned",name:"Planned",stroke:"#3b82f6",strokeDasharray:"5 5",dot:!1}),e.jsx(Q,{type:"monotone",dataKey:"actual",name:"Actual",stroke:"#22c55e",strokeWidth:2,dot:{r:4}})]})})]})}const te=()=>M.divIcon({html:`<div class="w-10 h-10 rounded-full flex items-center justify-center bg-blue-600 text-white shadow-lg border-2 border-white">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd" />
            </svg>
          </div>`,className:"custom-marker",iconSize:[40,40],iconAnchor:[20,40],popupAnchor:[0,-40]});function he({project:i,darkMode:n=!1}){if(!i.location)return e.jsxs(S,{darkMode:n,children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Project Location"}),e.jsx("p",{className:`text-center py-8 ${n?"text-gray-400":"text-gray-500"}`,children:"No location set for this project."})]});const[l,c]=i.location;return e.jsxs(S,{darkMode:n,children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Project Location"}),e.jsx("div",{className:"h-80 rounded-lg overflow-hidden",children:e.jsxs(Z,{center:[l,c],zoom:15,style:{height:"100%",width:"100%"},scrollWheelZoom:!1,children:[e.jsx(_,{attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),e.jsx(H,{position:[l,c],icon:te(),children:e.jsx(J,{children:e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-semibold",children:i.name}),e.jsxs("p",{children:["Lat: ",l.toFixed(6)]}),e.jsxs("p",{children:["Lng: ",c.toFixed(6)]})]})})})]})})]})}export{de as B,he as P,me as S,oe as W,xe as a};
