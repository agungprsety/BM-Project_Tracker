import{j as e}from"./vendor-query-dOYxXkJ3.js";import{f as q,a as i}from"./vendor-react-CfkJOBur.js";import{u as Y}from"./index-kT17AKTn.js";import{u as V,c as X,f as G,a as O}from"./utils-DGZViaHi.js";import{D as M}from"./districts-Z7EIMGL1.js";import{C as x,B as U}from"./Button-Dqt4D0nT.js";import{E as J,f as Q,g as Z,h as ee,C as te}from"./vendor-icons-Jh-DJkRq.js";import{R as se,B as re,X as ae,Y as le,T as ie,a as oe,C as ce}from"./vendor-charts-D7W35Enl.js";import"./vendor-pdf-D-ScUWta.js";import"./vendor-supabase-Dq-Jb853.js";const C=10,R=[{label:"0–25%",key:"low",color:"#dc2626",min:0,max:25},{label:"25–50%",key:"mid",color:"#d97706",min:25,max:50},{label:"50–75%",key:"high",color:"#2563eb",min:50,max:75},{label:"75–100%",key:"done",color:"#16a34a",min:75,max:101}];function je(){const z=q(),{darkMode:r}=Y(),{data:f=[],isLoading:F}=V(),[h,k]=i.useState(""),[y,L]=i.useState("progress"),[v,w]=i.useState("desc"),[m,o]=i.useState(1),[n,b]=i.useState(null),[c,S]=i.useState(""),[g,N]=i.useState(""),d=i.useMemo(()=>f.map(t=>{var s;return{...t,_progress:X(t.boq||[],t.weeklyReports||[]),_value:((s=t.boq)==null?void 0:s.reduce((a,l)=>a+l.quantity*l.unitPrice,0))||0}}),[f]),B=d.reduce((t,s)=>t+s._value,0),E=d.length>0?d.reduce((t,s)=>t+s._progress,0)/d.length:0,T=d.reduce((t,s)=>t+(s.length||0),0),j=i.useMemo(()=>{let t=[...d];if(h){const s=h.toLowerCase();t=t.filter(a=>a.name.toLowerCase().includes(s)||a.contractor.toLowerCase().includes(s)||a.supervisor.toLowerCase().includes(s))}return c&&(t=t.filter(s=>s.district===c)),g&&(t=t.filter(s=>s.subDistrict===g)),t},[d,h,c,g]),D=i.useMemo(()=>R.map(t=>({...t,count:j.filter(s=>s._progress>=t.min&&s._progress<t.max).length})),[j]),W=i.useMemo(()=>{if(!c)return[];const t=M.find(s=>s.name===c);return t?t.subDistricts:[]},[c]),P=i.useMemo(()=>{let t=[...j];if(n){const s=R.find(a=>a.key===n);s&&(t=t.filter(a=>a._progress>=s.min&&a._progress<s.max))}return t.sort((s,a)=>{let l=0;switch(y){case"name":l=s.name.localeCompare(a.name);break;case"contractor":l=s.contractor.localeCompare(a.contractor);break;case"supervisor":l=s.supervisor.localeCompare(a.supervisor);break;case"progress":l=s._progress-a._progress;break;case"value":l=s._value-a._value;break;case"district":l=(s.district||"").localeCompare(a.district||"");break;case"subDistrict":l=(s.subDistrict||"").localeCompare(a.subDistrict||"");break;case"averageWidth":l=(s.averageWidth||0)-(a.averageWidth||0);break;case"length":l=(s.length||0)-(a.length||0);break;case"roadHierarchy":l=(s.roadHierarchy||"").localeCompare(a.roadHierarchy||"");break}return v==="asc"?l:-l}),t},[j,n,y,v]),p=Math.max(1,Math.ceil(P.length/C)),_=Math.min(m,p),$=P.slice((_-1)*C,_*C),H=n||c||g||h,I=()=>{b(null),S(""),N(""),k(""),o(1)},u=t=>{y===t?w(v==="asc"?"desc":"asc"):(L(t),w("asc")),o(1)},K=t=>t>=75?"bg-green-500":t>=50?"bg-blue-500":t>=25?"bg-amber-500":"bg-red-500",A=`px-3 py-2 border rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors ${r?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`;return F?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:`flex items-center gap-2 px-4 py-2.5 rounded-xl text-sm font-medium ${r?"bg-blue-900/40 text-blue-300 border border-blue-700/50":"bg-blue-50 text-blue-700 border border-blue-200"}`,children:[e.jsx(J,{size:16}),e.jsxs("span",{children:["You are viewing the ",e.jsx("strong",{children:"public project directory"}),". Select a project to see detailed progress."]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs(x,{darkMode:r,children:[e.jsx("p",{className:`text-sm font-medium mb-2 ${r?"text-gray-400":"text-gray-600"}`,children:"Active Projects"}),e.jsx("p",{className:"text-3xl font-bold",children:f.length})]}),e.jsxs(x,{darkMode:r,children:[e.jsx("p",{className:`text-sm font-medium mb-2 ${r?"text-gray-400":"text-gray-600"}`,children:"Total Investment"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:G(B)})]}),e.jsxs(x,{darkMode:r,children:[e.jsx("p",{className:`text-sm font-medium mb-2 ${r?"text-gray-400":"text-gray-600"}`,children:"Avg Progress"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:[E.toFixed(1),"%"]})]}),e.jsxs(x,{darkMode:r,children:[e.jsx("p",{className:`text-sm font-medium mb-2 ${r?"text-gray-400":"text-gray-600"}`,children:"Road Infrastructure"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:O(T)})]})]}),f.length===0?e.jsx(x,{darkMode:r,className:"text-center py-12",children:e.jsx("p",{className:`text-lg mb-4 ${r?"text-gray-400":"text-gray-600"}`,children:"No public projects found."})}):e.jsxs(e.Fragment,{children:[e.jsxs(x,{darkMode:r,children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("div",{children:e.jsx("h3",{className:"text-lg font-semibold",children:"Progress Distribution"})}),n&&e.jsx("button",{onClick:()=>{b(null),o(1)},className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"Clear filter ×"})]}),e.jsx(se,{width:"100%",height:150,children:e.jsxs(re,{data:D,margin:{left:15,right:10,top:10,bottom:20},children:[e.jsx(ae,{dataKey:"label",tick:{fontSize:12},label:{value:"Progress (%)",position:"insideBottom",offset:-15,fontSize:12}}),e.jsx(le,{allowDecimals:!1,tick:{fontSize:12},label:{value:"No. of Projects",angle:-90,position:"insideLeft",offset:-5,fontSize:12}}),e.jsx(ie,{formatter:t=>[`${t} projects`,"Count"],contentStyle:r?{backgroundColor:"#1f2937",border:"1px solid #374151",borderRadius:"8px"}:{borderRadius:"8px"}}),e.jsx(oe,{dataKey:"count",radius:[4,4,0,0],cursor:"pointer",onClick:t=>{n===t.key?b(null):b(t.key),o(1)},children:D.map((t,s)=>e.jsx(ce,{fill:t.color,opacity:n&&n!==t.key?.3:1},s))})]})})]}),e.jsxs(x,{darkMode:r,children:[e.jsxs("div",{className:"flex flex-col gap-3 mb-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Project Directory"}),e.jsxs("div",{className:"relative w-full sm:w-64",children:[e.jsx(Q,{size:16,className:`absolute left-3 top-1/2 -translate-y-1/2 ${r?"text-gray-500":"text-gray-400"}`}),e.jsx("input",{type:"text",placeholder:"Search projects...",value:h,onChange:t=>{k(t.target.value),o(1)},className:`w-full pl-9 pr-3 py-2 border rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors ${r?"bg-gray-700 border-gray-600 text-white placeholder-gray-400":"bg-white border-gray-300 placeholder-gray-400"}`})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx(Z,{size:16,className:r?"text-gray-400":"text-gray-500"}),e.jsxs("select",{value:c,onChange:t=>{S(t.target.value),N(""),o(1)},className:A,children:[e.jsx("option",{value:"",children:"All Districts"}),M.map(t=>e.jsx("option",{value:t.name,children:t.name},t.code))]}),e.jsxs("select",{value:g,onChange:t=>{N(t.target.value),o(1)},className:A,disabled:!c,children:[e.jsx("option",{value:"",children:"All Sub-districts"}),W.map(t=>e.jsx("option",{value:t,children:t},t))]}),H&&e.jsx("button",{onClick:I,className:"text-sm text-blue-600 hover:text-blue-700 font-medium ml-auto",children:"Clear all ×"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:r?"bg-gray-700 text-gray-300":"bg-gray-50 text-gray-500",children:[e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium cursor-pointer",onClick:()=>u("name"),children:"Project"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium cursor-pointer",onClick:()=>u("district"),children:"District"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium cursor-pointer",onClick:()=>u("averageWidth"),children:"Avg Width"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium cursor-pointer",onClick:()=>u("length"),children:"Length"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium cursor-pointer",onClick:()=>u("roadHierarchy"),children:"Road Hierarchy"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium cursor-pointer",onClick:()=>u("progress"),children:"Progress"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium",children:"Actions"})]})}),e.jsx("tbody",{children:$.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"px-3 py-8 text-center text-sm text-gray-500",children:"No projects found matching the criteria."})}):$.map(t=>e.jsxs("tr",{className:`border-t ${r?"border-gray-700 hover:bg-gray-700":"border-gray-200 hover:bg-gray-50"} transition-colors`,children:[e.jsx("td",{className:"px-3 py-3",children:e.jsx("div",{className:"font-medium",children:t.name})}),e.jsx("td",{className:"px-3 py-3 text-sm",children:t.district||"-"}),e.jsx("td",{className:"px-3 py-3 text-sm",children:t.averageWidth?`${t.averageWidth} m`:"-"}),e.jsx("td",{className:"px-3 py-3 text-sm",children:t.length?`${t.length} m`:"-"}),e.jsx("td",{className:"px-3 py-3 text-sm",children:t.roadHierarchy||"-"}),e.jsx("td",{className:"px-3 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-16 ${r?"bg-gray-600":"bg-gray-200"} rounded-full h-1.5`,children:e.jsx("div",{className:`${K(t._progress)} h-1.5 rounded-full`,style:{width:`${t._progress}%`}})}),e.jsxs("span",{className:"text-xs font-medium",children:[t._progress.toFixed(0),"%"]})]})}),e.jsx("td",{className:"px-3 py-3",children:e.jsx(U,{size:"sm",variant:"secondary",onClick:()=>z(`/view/${t.id}`),children:"View Details"})})]},t.id))})]})}),p>1&&e.jsx("div",{className:"flex items-center justify-between mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>o(Math.max(1,m-1)),disabled:m===1,className:"p-1 rounded hover:bg-gray-100 dark:hover:bg-gray-700 disabled:opacity-50",children:e.jsx(ee,{size:20})}),e.jsxs("span",{className:"text-sm",children:[m," of ",p]}),e.jsx("button",{onClick:()=>o(Math.min(p,m+1)),disabled:m===p,className:"p-1 rounded hover:bg-gray-100 dark:hover:bg-gray-700 disabled:opacity-50",children:e.jsx(te,{size:20})})]})})]})]})]})}export{je as default};
